using System;
using System.Reflection;

namespace At.Matus.BevMetrology
{
    public static class BevCie
    {
        private const int lowerIntegrationLimit = 360;
        private const int upperIntegrationLimit = 830;

        /// <summary>
        /// Spectral radiance of a black body
        /// </summary>
        /// <param name="T">Thermodynamic temperature in K</param>
        /// <param name="wavelength">Wavelength in air, in nm</param>
        /// <returns>Spectral radiance in W.m^-2.nm^-1.sr^-1</returns>
        /// <remarks>Reference: PTB Mitteilungen 107 6/97, p.397</remarks>
        /// <remarks>Lichtgeschwindigkeit:     c  = 299792458 m/s  </remarks>
        /// <remarks>Brechzahl fuer Normalluft n  = 1.00028</remarks>
        /// <remarks>1.Strahlungskonstante     c1 = 3.7417749e-16 W.s^2</remarks>
        /// <remarks>2.Strahlungskonstante     c2 = 1.438769e-2 m.K</remarks>
        /// <remarks>Update! SI 2019 </remarks>
        /// <remarks>Wellenlänge in Vakuum</remarks>
        /// <remarks>1.Strahlungskonstante     c1 = 1.191 042 972 E-16 W m^2 sr^-1 </remarks>
        /// <remarks>2.Strahlungskonstante     c2 = 1.438 776 877 5 E-2 m K </remarks>
        public static double LPlanck(double T, double wavelength)
        {
            const double c1 = 1.191_042_972e20; // ob wirklich?
            const double c2 = 1.438_776_877_5e7;
            double L = c1 / (wavelength * wavelength * wavelength * wavelength * wavelength * (Math.Exp(c2 / (wavelength * T)) - 1.0));
            return L;
        }
        public static double LPlanck(double T, int wavelength) => LPlanck(T, (double)wavelength);

        /// <summary>
        /// CIE Illuminant A 
        /// ÖNORM EN ISO/CIE 11664-2:2023
        /// entspricht T = 2855.496 K
        /// </summary>
        /// <param name="wavelength">Wavelength in air, in nm</param>
        /// <returns>Value for given wavelength</returns>
        /// <remarks>Reference: CIE Standard Illuminants for Colorimetry</remarks>
        public static double CieIlluminantA(double wavelength)
        {
            double nwn = 560.0 / wavelength;
            double nwn5 = nwn * nwn * nwn * nwn * nwn;
            //return nwn5 * 100 * (Math.Exp(1435000.0 / 159488.0) - 1.0) / (Math.Exp(14350000.0 / (2848.0 * wavelength)) - 1.0);
            return nwn5 * 808219.20955666085244714 / (Math.Exp(5038.623595505617977528089887640 / wavelength) - 1.0);
        }
        public static double CieIlluminantA(int wavelength) => CieIlluminantA((double)wavelength);

        /// <summary>
        /// CIE Illuminant D65 
        /// </summary>
        /// <param name="wavelength">Wavelength in air, in nm</param>
        /// <returns>Value for given wavelength</returns>
        /// <remarks>Reference: ÖNORM EN ISO/CIE 11664-2:2023</remarks>
        public static double CieIlluminantD65(int wavelength) => ConvertArrayToFunction(wavelength, cieD65, 300);

        /// <summary>
        /// CIE Illuminant D50 
        /// </summary>
        /// <param name="wavelength">Wavelength in air, in nm</param>
        /// <returns>Value for given wavelength</returns>
        /// <remarks>Reference: ÖNORM EN ISO/CIE 11664-2:2023</remarks>
        public static double CieIlluminantD50(int wavelength) => ConvertArrayToFunction(wavelength, cieD50, 300);


        /// <summary>
        /// Spectral luminous efficiency for photopic vision
        /// </summary>
        /// <param name="wavelength">Wavelength in air, in nm</param>
        /// <returns>Value for given wavelength</returns>
        /// <remarks>Reference: Rapport BIPM-2019/05</remarks>
        public static double CieV(int wavelength) => ConvertArrayToFunction(wavelength, cieV, 360);

        /// <summary>
        /// Spectral luminous efficiency for scotopic vision
        /// </summary>
        /// <param name="wavelength">Wavelength in air, in nm</param>
        /// <returns>Value for given wavelength</returns>
        /// <remarks>Reference: Rapport BIPM-2019/05</remarks>
        public static double CieVs(int wavelength) => ConvertArrayToFunction(wavelength, cieVs, 380);

        /// <summary>
        /// CIE 1931 colour-matching function, x_bar
        /// </summary>
        /// <param name="wavelength">Wavelength in air, in nm</param>
        /// <returns>Value for given wavelength</returns>
        /// <remarks>Reference: Rapport BIPM-2019/05</remarks>
        public static double CieX2(int wavelength) => ConvertArrayToFunction(wavelength, cieX2, 360);

        /// <summary>
        /// CIE 1931 colour-matching function, y_bar
        /// </summary>
        /// <param name="wavelength">Wavelength in air, in nm</param>
        /// <returns>Value for given wavelength</returns>
        /// <remarks>Reference: Rapport BIPM-2019/05</remarks>
        public static double CieY2(int wavelength) => CieV(wavelength);

        /// <summary>
        /// CIE 1931 colour-matching function, z_bar
        /// </summary>
        /// <param name="wavelength">Wavelength in air, in nm</param>
        /// <returns>Value for given wavelength</returns>
        /// <remarks>Reference: Rapport BIPM-2019/05</remarks>
        public static double CieZ2(int wavelength) => ConvertArrayToFunction(wavelength, cieZ2, 360);

        /// <summary>
        /// Spectral mismatch correction factor relativ to CIE Illuminant A.
        /// </summary>
        /// <param name="specResponse">Relative spectral responsivity of photometer.</param>
        /// <param name="specPower">Spectral power distribution of test source.</param>
        /// <returns></returns>
        public static double CcfStar(Func<int, double> specResponse, Func<int, double> specPower)
        {
            double a = Integrate(CieIlluminantA, specResponse);
            double b = Integrate(specPower, CieV);
            double c = Integrate(CieIlluminantA, CieV); // this is a constant!
            double d = Integrate(specPower, specResponse);
            return a * b / (c * d);
        }

        /// <summary>
        /// Spectral mismatch correction factor relativ to CIE Illuminant A.
        /// </summary>
        /// <param name="specResponse">Relative spectral responsivity of photometer.</param>
        /// <param name="temperature">Distribution temperature of test source.</param>
        /// <returns></returns>
        public static double CcfStar(Func<int, double> specResponse, double temperature)
        {
            double plank(int i) => LPlanck(temperature, i);
            return CcfStar(specResponse, plank);
        }

        public static double Integrate(Func<int, double> spec, Func<int, double> weight)
        {
            double weightedSpec(int i) => spec(i) * weight(i);
            return Integrate(weightedSpec);
        }

        public static double Integrate(Func<int, double> spec)
        {
            double integral = 0.0;
            for (int i = lowerIntegrationLimit; i <= upperIntegrationLimit; i++)
            {
                integral += spec(i);
            }
            return integral;
        }

        #region private stuff

        // TODO implement cieX10, cieY10, cieZ10

        private static readonly double[] cieX2 = new double[]
{
0.000129900000,
0.000145847000,
0.000163802100,
0.000184003700,
0.000206690200,
0.000232100000,
0.000260728000,
0.000293075000,
0.000329388000,
0.000369914000,
0.000414900000,
0.000464158700,
0.000518986000,
0.000581854000,
0.000655234700,
0.000741600000,
0.000845029600,
0.000964526800,
0.001094949000,
0.001231154000,
0.001368000000,
0.001502050000,
0.001642328000,
0.001802382000,
0.001995757000,
0.002236000000,
0.002535385000,
0.002892603000,
0.003300829000,
0.003753236000,
0.004243000000,
0.004762389000,
0.005330048000,
0.005978712000,
0.006741117000,
0.007650000000,
0.008751373000,
0.010028880000,
0.011421700000,
0.012869010000,
0.014310000000,
0.015704430000,
0.017147440000,
0.018781220000,
0.020748010000,
0.023190000000,
0.026207360000,
0.029782480000,
0.033880920000,
0.038468240000,
0.043510000000,
0.048995600000,
0.055022600000,
0.061718800000,
0.069212000000,
0.077630000000,
0.086958110000,
0.097176720000,
0.108406300000,
0.120767200000,
0.134380000000,
0.149358200000,
0.165395700000,
0.181983100000,
0.198611000000,
0.214770000000,
0.230186800000,
0.244879700000,
0.258777300000,
0.271807900000,
0.283900000000,
0.294943800000,
0.304896500000,
0.313787300000,
0.321645400000,
0.328500000000,
0.334351300000,
0.339210100000,
0.343121300000,
0.346129600000,
0.348280000000,
0.349599900000,
0.350147400000,
0.350013000000,
0.349287000000,
0.348060000000,
0.346373300000,
0.344262400000,
0.341808800000,
0.339094100000,
0.336200000000,
0.333197700000,
0.330041100000,
0.326635700000,
0.322886800000,
0.318700000000,
0.314025100000,
0.308884000000,
0.303290400000,
0.297257900000,
0.290800000000,
0.283970100000,
0.276721400000,
0.268917800000,
0.260422700000,
0.251100000000,
0.240847500000,
0.229851200000,
0.218407200000,
0.206811500000,
0.195360000000,
0.184213600000,
0.173327300000,
0.162688100000,
0.152283300000,
0.142100000000,
0.132178600000,
0.122569600000,
0.113275200000,
0.104297900000,
0.095640000000,
0.087299550000,
0.079308040000,
0.071717760000,
0.064580990000,
0.057950010000,
0.051862110000,
0.046281520000,
0.041150880000,
0.036412830000,
0.032010000000,
0.027917200000,
0.024144400000,
0.020687000000,
0.017540400000,
0.014700000000,
0.012161790000,
0.009919960000,
0.007967240000,
0.006296346000,
0.004900000000,
0.003777173000,
0.002945320000,
0.002424880000,
0.002236293000,
0.002400000000,
0.002925520000,
0.003836560000,
0.005174840000,
0.006982080000,
0.009300000000,
0.012149490000,
0.015535880000,
0.019477520000,
0.023992770000,
0.029100000000,
0.034814850000,
0.041120160000,
0.047985040000,
0.055378610000,
0.063270000000,
0.071635010000,
0.080462240000,
0.089739960000,
0.099456450000,
0.109600000000,
0.120167400000,
0.131114500000,
0.142367900000,
0.153854200000,
0.165500000000,
0.177257100000,
0.189140000000,
0.201169400000,
0.213365800000,
0.225749900000,
0.238320900000,
0.251066800000,
0.263992200000,
0.277101700000,
0.290400000000,
0.303891200000,
0.317572600000,
0.331438400000,
0.345482800000,
0.359700000000,
0.374083900000,
0.388639600000,
0.403378400000,
0.418311500000,
0.433449900000,
0.448795300000,
0.464336000000,
0.480064000000,
0.495971300000,
0.512050100000,
0.528295900000,
0.544691600000,
0.561209400000,
0.577821500000,
0.594500000000,
0.611220900000,
0.627975800000,
0.644760200000,
0.661569700000,
0.678400000000,
0.695239200000,
0.712058600000,
0.728828400000,
0.745518800000,
0.762100000000,
0.778543200000,
0.794825600000,
0.810926400000,
0.826824800000,
0.842500000000,
0.857932500000,
0.873081600000,
0.887894400000,
0.902318100000,
0.916300000000,
0.929799500000,
0.942798400000,
0.955277600000,
0.967217900000,
0.978600000000,
0.989385600000,
0.999548800000,
1.009089200000,
1.018006400000,
1.026300000000,
1.033982700000,
1.040986000000,
1.047188000000,
1.052466700000,
1.056700000000,
1.059794400000,
1.061799200000,
1.062806800000,
1.062909600000,
1.062200000000,
1.060735200000,
1.058443600000,
1.055224400000,
1.050976800000,
1.045600000000,
1.039036900000,
1.031360800000,
1.022666200000,
1.013047700000,
1.002600000000,
0.991367500000,
0.979331400000,
0.966491600000,
0.952847900000,
0.938400000000,
0.923194000000,
0.907244000000,
0.890502000000,
0.872920000000,
0.854449900000,
0.835084000000,
0.814946000000,
0.794186000000,
0.772954000000,
0.751400000000,
0.729583600000,
0.707588800000,
0.685602200000,
0.663810400000,
0.642400000000,
0.621514900000,
0.601113800000,
0.581105200000,
0.561397700000,
0.541900000000,
0.522599500000,
0.503546400000,
0.484743600000,
0.466193900000,
0.447900000000,
0.429861300000,
0.412098000000,
0.394644000000,
0.377533300000,
0.360800000000,
0.344456300000,
0.328516800000,
0.313019200000,
0.298001100000,
0.283500000000,
0.269544800000,
0.256118400000,
0.243189600000,
0.230727200000,
0.218700000000,
0.207097100000,
0.195923200000,
0.185170800000,
0.174832300000,
0.164900000000,
0.155366700000,
0.146230000000,
0.137490000000,
0.129146700000,
0.121200000000,
0.113639700000,
0.106465000000,
0.099690440000,
0.093330610000,
0.087400000000,
0.081900960000,
0.076804280000,
0.072077120000,
0.067686640000,
0.063600000000,
0.059806850000,
0.056282160000,
0.052971040000,
0.049818610000,
0.046770000000,
0.043784050000,
0.040875360000,
0.038072640000,
0.035404610000,
0.032900000000,
0.030564190000,
0.028380560000,
0.026344840000,
0.024452750000,
0.022700000000,
0.021084290000,
0.019599880000,
0.018237320000,
0.016987170000,
0.015840000000,
0.014790640000,
0.013831320000,
0.012948680000,
0.012129200000,
0.011359160000,
0.010629350000,
0.009938846000,
0.009288422000,
0.008678854000,
0.008110916000,
0.007582388000,
0.007088746000,
0.006627313000,
0.006195408000,
0.005790346000,
0.005409826000,
0.005052583000,
0.004717512000,
0.004403507000,
0.004109457000,
0.003833913000,
0.003575748000,
0.003334342000,
0.003109075000,
0.002899327000,
0.002704348000,
0.002523020000,
0.002354168000,
0.002196616000,
0.002049190000,
0.001910960000,
0.001781438000,
0.001660110000,
0.001546459000,
0.001439971000,
0.001340042000,
0.001246275000,
0.001158471000,
0.001076430000,
0.000999949300,
0.000928735800,
0.000862433200,
0.000800750300,
0.000743396000,
0.000690078600,
0.000640515600,
0.000594502100,
0.000551864600,
0.000512429000,
0.000476021300,
0.000442453600,
0.000411511700,
0.000382981400,
0.000356649100,
0.000332301100,
0.000309758600,
0.000288887100,
0.000269539400,
0.000251568200,
0.000234826100,
0.000219171000,
0.000204525800,
0.000190840500,
0.000178065400,
0.000166150500,
0.000155023600,
0.000144621900,
0.000134909800,
0.000125852000,
0.000117413000,
0.000109551500,
0.000102224500,
0.000095394450,
0.000089023900,
0.000083075270,
0.000077512690,
0.000072313040,
0.000067457780,
0.000062928440,
0.000058706520,
0.000054770280,
0.000051099180,
0.000047676540,
0.000044485670,
0.000041509940,
0.000038733240,
0.000036142030,
0.000033723520,
0.000031464870,
0.000029353260,
0.000027375730,
0.000025524330,
0.000023793760,
0.000022178700,
0.000020673830,
0.000019272260,
0.000017966400,
0.000016749910,
0.000015616480,
0.000014559770,
0.000013573870,
0.000012654360,
0.000011797230,
0.000010998440,
0.000010253980,
0.000009559646,
0.000008912044,
0.000008308358,
0.000007745769,
0.000007221456,
0.000006732475,
0.000006276423,
0.000005851304,
0.000005455118,
0.000005085868,
0.000004741466,
0.000004420236,
0.000004120783,
0.000003841716,
0.000003581652,
0.000003339127,
0.000003112949,
0.000002902121,
0.000002705645,
0.000002522525,
0.000002351726,
0.000002192415,
0.000002043902,
0.000001905497,
0.000001776509,
0.000001656215,
0.000001544022,
0.000001439440,
0.000001341977,
0.000001251141
};

        private static readonly double[] cieV = new double[]
        {
            3.917000e-6 ,
            4.393581e-6 ,
            4.929604e-6 ,
            5.532136e-6 ,
            6.208245e-6 ,
            6.965000e-6 ,
            7.813219e-6 ,
            8.767336e-6 ,
            9.839844e-6 ,
            1.104323e-5 ,
            1.239000e-5 ,
            1.388641e-5 ,
            1.555728e-5 ,
            1.744296e-5 ,
            1.958375e-5 ,
            2.202000e-5 ,
            2.483965e-5 ,
            2.804126e-5 ,
            3.153104e-5 ,
            3.521521e-5 ,
            3.900000e-5 ,
            4.282640e-5 ,
            4.691460e-5 ,
            5.158960e-5 ,
            5.717640e-5 ,
            6.400000e-5 ,
            7.234421e-5 ,
            8.221224e-5 ,
            9.350816e-5 ,
            1.061361e-4 ,
            1.200000e-4 ,
            1.349840e-4 ,
            1.514920e-4 ,
            1.702080e-4 ,
            1.918160e-4 ,
            2.170000e-4 ,
            2.469067e-4 ,
            2.812400e-4 ,
            3.185200e-4 ,
            3.572667e-4 ,
            3.960000e-4 ,
            4.337147e-4 ,
            4.730240e-4 ,
            5.178760e-4 ,
            5.722187e-4 ,
            6.400000e-4 ,
            7.245600e-4 ,
            8.255000e-4 ,
            9.411600e-4 ,
            1.069880e-3 ,
            1.210000e-3 ,
            1.362091e-3 ,
            1.530752e-3 ,
            1.720368e-3 ,
            1.935323e-3 ,
            2.180000e-3 ,
            2.454800e-3 ,
            2.764000e-3 ,
            3.117800e-3 ,
            3.526400e-3 ,
            4.000000e-3 ,
            4.546240e-3 ,
            5.159320e-3 ,
            5.829280e-3 ,
            6.546160e-3 ,
            7.300000e-3 ,
            8.086507e-3 ,
            8.908720e-3 ,
            9.767680e-3 ,
            1.066443e-2 ,
            1.160000e-2 ,
            1.257317e-2 ,
            1.358272e-2 ,
            1.462968e-2 ,
            1.571509e-2 ,
            1.684000e-2 ,
            1.800736e-2 ,
            1.921448e-2 ,
            2.045392e-2 ,
            2.171824e-2 ,
            2.300000e-2 ,
            2.429461e-2 ,
            2.561024e-2 ,
            2.695857e-2 ,
            2.835125e-2 ,
            2.980000e-2 ,
            3.131083e-2 ,
            3.288368e-2 ,
            3.452112e-2 ,
            3.622571e-2 ,
            3.800000e-2 ,
            3.984667e-2 ,
            4.176800e-2 ,
            4.376600e-2 ,
            4.584267e-2 ,
            4.800000e-2 ,
            5.024368e-2 ,
            5.257304e-2 ,
            5.498056e-2 ,
            5.745872e-2 ,
            6.000000e-2 ,
            6.260197e-2 ,
            6.527752e-2 ,
            6.804208e-2 ,
            7.091109e-2 ,
            7.390000e-2 ,
            7.701600e-2 ,
            8.026640e-2 ,
            8.366680e-2 ,
            8.723280e-2 ,
            9.098000e-2 ,
            9.491755e-2 ,
            9.904584e-2 ,
            1.033674e-1 ,
            1.078846e-1 ,
            1.126000e-1 ,
            1.175320e-1 ,
            1.226744e-1 ,
            1.279928e-1 ,
            1.334528e-1 ,
            1.390200e-1 ,
            1.446764e-1 ,
            1.504693e-1 ,
            1.564619e-1 ,
            1.627177e-1 ,
            1.693000e-1 ,
            1.762431e-1 ,
            1.835581e-1 ,
            1.912735e-1 ,
            1.994180e-1 ,
            2.080200e-1 ,
            2.171199e-1 ,
            2.267345e-1 ,
            2.368571e-1 ,
            2.474812e-1 ,
            2.586000e-1 ,
            2.701849e-1 ,
            2.822939e-1 ,
            2.950505e-1 ,
            3.085780e-1 ,
            3.230000e-1 ,
            3.384021e-1 ,
            3.546858e-1 ,
            3.716986e-1 ,
            3.892875e-1 ,
            4.073000e-1 ,
            4.256299e-1 ,
            4.443096e-1 ,
            4.633944e-1 ,
            4.829395e-1 ,
            5.030000e-1 ,
            5.235693e-1 ,
            5.445120e-1 ,
            5.656900e-1 ,
            5.869653e-1 ,
            6.082000e-1 ,
            6.293456e-1 ,
            6.503068e-1 ,
            6.708752e-1 ,
            6.908424e-1 ,
            7.100000e-1 ,
            7.281852e-1 ,
            7.454636e-1 ,
            7.619694e-1 ,
            7.778368e-1 ,
            7.932000e-1 ,
            8.081104e-1 ,
            8.224962e-1 ,
            8.363068e-1 ,
            8.494916e-1 ,
            8.620000e-1 ,
            8.738108e-1 ,
            8.849624e-1 ,
            8.954936e-1 ,
            9.054432e-1 ,
            9.148501e-1 ,
            9.237348e-1 ,
            9.320924e-1 ,
            9.399226e-1 ,
            9.472252e-1 ,
            9.540000e-1 ,
            9.602561e-1 ,
            9.660074e-1 ,
            9.712606e-1 ,
            9.760225e-1 ,
            9.803000e-1 ,
            9.840924e-1 ,
            9.874182e-1 ,
            9.903128e-1 ,
            9.928116e-1 ,
            9.949501e-1 ,
            9.967108e-1 ,
            9.980983e-1 ,
            9.991120e-1 ,
            9.997482e-1 ,
            1.000000e+0 ,
            9.998567e-1 ,
            9.993046e-1 ,
            9.983255e-1 ,
            9.968987e-1 ,
            9.950000e-1 ,
            9.926005e-1 ,
            9.897426e-1 ,
            9.864444e-1 ,
            9.827241e-1 ,
            9.786000e-1 ,
            9.740837e-1 ,
            9.691712e-1 ,
            9.638568e-1 ,
            9.581349e-1 ,
            9.520000e-1 ,
            9.454504e-1 ,
            9.384992e-1 ,
            9.311628e-1 ,
            9.234576e-1 ,
            9.154000e-1 ,
            9.070064e-1 ,
            8.982772e-1 ,
            8.892048e-1 ,
            8.797816e-1 ,
            8.700000e-1 ,
            8.598613e-1 ,
            8.493920e-1 ,
            8.386220e-1 ,
            8.275813e-1 ,
            8.163000e-1 ,
            8.047947e-1 ,
            7.930820e-1 ,
            7.811920e-1 ,
            7.691547e-1 ,
            7.570000e-1 ,
            7.447541e-1 ,
            7.324224e-1 ,
            7.200036e-1 ,
            7.074965e-1 ,
            6.949000e-1 ,
            6.822192e-1 ,
            6.694716e-1 ,
            6.566744e-1 ,
            6.438448e-1 ,
            6.310000e-1 ,
            6.181555e-1 ,
            6.053144e-1 ,
            5.924756e-1 ,
            5.796379e-1 ,
            5.668000e-1 ,
            5.539611e-1 ,
            5.411372e-1 ,
            5.283528e-1 ,
            5.156323e-1 ,
            5.030000e-1 ,
            4.904688e-1 ,
            4.780304e-1 ,
            4.656776e-1 ,
            4.534032e-1 ,
            4.412000e-1 ,
            4.290800e-1 ,
            4.170360e-1 ,
            4.050320e-1 ,
            3.930320e-1 ,
            3.810000e-1 ,
            3.689184e-1 ,
            3.568272e-1 ,
            3.447768e-1 ,
            3.328176e-1 ,
            3.210000e-1 ,
            3.093381e-1 ,
            2.978504e-1 ,
            2.865936e-1 ,
            2.756245e-1 ,
            2.650000e-1 ,
            2.547632e-1 ,
            2.448896e-1 ,
            2.353344e-1 ,
            2.260528e-1 ,
            2.170000e-1 ,
            2.081616e-1 ,
            1.995488e-1 ,
            1.911552e-1 ,
            1.829744e-1 ,
            1.750000e-1 ,
            1.672235e-1 ,
            1.596464e-1 ,
            1.522776e-1 ,
            1.451259e-1 ,
            1.382000e-1 ,
            1.315003e-1 ,
            1.250248e-1 ,
            1.187792e-1 ,
            1.127691e-1 ,
            1.070000e-1 ,
            1.014762e-1 ,
            9.618864e-2 ,
            9.112296e-2 ,
            8.626485e-2 ,
            8.160000e-2 ,
            7.712064e-2 ,
            7.282552e-2 ,
            6.871008e-2 ,
            6.476976e-2 ,
            6.100000e-2 ,
            5.739621e-2 ,
            5.395504e-2 ,
            5.067376e-2 ,
            4.754965e-2 ,
            4.458000e-2 ,
            4.175872e-2 ,
            3.908496e-2 ,
            3.656384e-2 ,
            3.420048e-2 ,
            3.200000e-2 ,
            2.996261e-2 ,
            2.807664e-2 ,
            2.632936e-2 ,
            2.470805e-2 ,
            2.320000e-2 ,
            2.180077e-2 ,
            2.050112e-2 ,
            1.928108e-2 ,
            1.812069e-2 ,
            1.700000e-2 ,
            1.590379e-2 ,
            1.483718e-2 ,
            1.381068e-2 ,
            1.283478e-2 ,
            1.192000e-2 ,
            1.106831e-2 ,
            1.027339e-2 ,
            9.533311e-3 ,
            8.846157e-3 ,
            8.210000e-3 ,
            7.623781e-3 ,
            7.085424e-3 ,
            6.591476e-3 ,
            6.138485e-3 ,
            5.723000e-3 ,
            5.343059e-3 ,
            4.995796e-3 ,
            4.676404e-3 ,
            4.380075e-3 ,
            4.102000e-3 ,
            3.838453e-3 ,
            3.589099e-3 ,
            3.354219e-3 ,
            3.134093e-3 ,
            2.929000e-3 ,
            2.738139e-3 ,
            2.559876e-3 ,
            2.393244e-3 ,
            2.237275e-3 ,
            2.091000e-3 ,
            1.953587e-3 ,
            1.824580e-3 ,
            1.703580e-3 ,
            1.590187e-3 ,
            1.484000e-3 ,
            1.384496e-3 ,
            1.291268e-3 ,
            1.204092e-3 ,
            1.122744e-3 ,
            1.047000e-3 ,
            9.765896e-4 ,
            9.111088e-4 ,
            8.501332e-4 ,
            7.932384e-4 ,
            7.400000e-4 ,
            6.900827e-4 ,
            6.433100e-4 ,
            5.994960e-4 ,
            5.584547e-4 ,
            5.200000e-4 ,
            4.839136e-4 ,
            4.500528e-4 ,
            4.183452e-4 ,
            3.887184e-4 ,
            3.611000e-4 ,
            3.353835e-4 ,
            3.114404e-4 ,
            2.891656e-4 ,
            2.684539e-4 ,
            2.492000e-4 ,
            2.313019e-4 ,
            2.146856e-4 ,
            1.992884e-4 ,
            1.850475e-4 ,
            1.719000e-4 ,
            1.597781e-4 ,
            1.486044e-4 ,
            1.383016e-4 ,
            1.287925e-4 ,
            1.200000e-4 ,
            1.118595e-4 ,
            1.043224e-4 ,
            9.733560e-5 ,
            9.084587e-5 ,
            8.480000e-5 ,
            7.914667e-5 ,
            7.385800e-5 ,
            6.891600e-5 ,
            6.430267e-5 ,
            6.000000e-5 ,
            5.598187e-5 ,
            5.222560e-5 ,
            4.871840e-5 ,
            4.544747e-5 ,
            4.240000e-5 ,
            3.956104e-5 ,
            3.691512e-5 ,
            3.444868e-5 ,
            3.214816e-5 ,
            3.000000e-5 ,
            2.799125e-5 ,
            2.611356e-5 ,
            2.436024e-5 ,
            2.272461e-5 ,
            2.120000e-5 ,
            1.977855e-5 ,
            1.845285e-5 ,
            1.721687e-5 ,
            1.606459e-5 ,
            1.499000e-5 ,
            1.398728e-5 ,
            1.305155e-5 ,
            1.217818e-5 ,
            1.136254e-5 ,
            1.060000e-5 ,
            9.885877e-6 ,
            9.217304e-6 ,
            8.592362e-6 ,
            8.009133e-6 ,
            7.465700e-6 ,
            6.959567e-6 ,
            6.487995e-6 ,
            6.048699e-6 ,
            5.639396e-6 ,
            5.257800e-6 ,
            4.901771e-6 ,
            4.569720e-6 ,
            4.260194e-6 ,
            3.971739e-6 ,
            3.702900e-6 ,
            3.452163e-6 ,
            3.218302e-6 ,
            3.000300e-6 ,
            2.797139e-6 ,
            2.607800e-6 ,
            2.431220e-6 ,
            2.266531e-6 ,
            2.113013e-6 ,
            1.969943e-6 ,
            1.836600e-6 ,
            1.712230e-6 ,
            1.596228e-6 ,
            1.488090e-6 ,
            1.387314e-6 ,
            1.293400e-6 ,
            1.205820e-6 ,
            1.124143e-6 ,
            1.048009e-6 ,
            9.770578e-7 ,
            9.109300e-7 ,
            8.492513e-7 ,
            7.917212e-7 ,
            7.380904e-7 ,
            6.881098e-7 ,
            6.415300e-7 ,
            5.980895e-7 ,
            5.575746e-7 ,
            5.198080e-7 ,
            4.846123e-7 ,
            4.518100e-7
        };

        private static readonly double[] cieZ2 = new double[]
        {
0.000606100000 ,
0.000680879200 ,
0.000765145600 ,
0.000860012400 ,
0.000966592800 ,
0.001086000000 ,
0.001220586000 ,
0.001372729000 ,
0.001543579000 ,
0.001734286000 ,
0.001946000000 ,
0.002177777000 ,
0.002435809000 ,
0.002731953000 ,
0.003078064000 ,
0.003486000000 ,
0.003975227000 ,
0.004540880000 ,
0.005158320000 ,
0.005802907000 ,
0.006450001000 ,
0.007083216000 ,
0.007745488000 ,
0.008501152000 ,
0.009414544000 ,
0.010549990000 ,
0.011965800000 ,
0.013655870000 ,
0.015588050000 ,
0.017730150000 ,
0.020050010000 ,
0.022511360000 ,
0.025202880000 ,
0.028279720000 ,
0.031897040000 ,
0.036210000000 ,
0.041437710000 ,
0.047503720000 ,
0.054119880000 ,
0.060998030000 ,
0.067850010000 ,
0.074486320000 ,
0.081361560000 ,
0.089153640000 ,
0.098540480000 ,
0.110200000000 ,
0.124613300000 ,
0.141701700000 ,
0.161303500000 ,
0.183256800000 ,
0.207400000000 ,
0.233692100000 ,
0.262611400000 ,
0.294774600000 ,
0.330798500000 ,
0.371300000000 ,
0.416209100000 ,
0.465464200000 ,
0.519694800000 ,
0.579530300000 ,
0.645600000000 ,
0.718483800000 ,
0.796713300000 ,
0.877845900000 ,
0.959439000000 ,
1.039050100000 ,
1.115367300000 ,
1.188497100000 ,
1.258123300000 ,
1.323929600000 ,
1.385600000000 ,
1.442635200000 ,
1.494803500000 ,
1.542190300000 ,
1.584880700000 ,
1.622960000000 ,
1.656404800000 ,
1.685295900000 ,
1.709874500000 ,
1.730382100000 ,
1.747060000000 ,
1.760044600000 ,
1.769623300000 ,
1.776263700000 ,
1.780433400000 ,
1.782600000000 ,
1.782968200000 ,
1.781699800000 ,
1.779198200000 ,
1.775867100000 ,
1.772110000000 ,
1.768258900000 ,
1.764039000000 ,
1.758943800000 ,
1.752466300000 ,
1.744100000000 ,
1.733559500000 ,
1.720858100000 ,
1.705936900000 ,
1.688737200000 ,
1.669200000000 ,
1.647528700000 ,
1.623412700000 ,
1.596022300000 ,
1.564528000000 ,
1.528100000000 ,
1.486111400000 ,
1.439521500000 ,
1.389879900000 ,
1.338736200000 ,
1.287640000000 ,
1.237422300000 ,
1.187824300000 ,
1.138761100000 ,
1.090148000000 ,
1.041900000000 ,
0.994197600000 ,
0.947347300000 ,
0.901453100000 ,
0.856619300000 ,
0.812950100000 ,
0.770517300000 ,
0.729444800000 ,
0.689913600000 ,
0.652104900000 ,
0.616200000000 ,
0.582328600000 ,
0.550416200000 ,
0.520337600000 ,
0.491967300000 ,
0.465180000000 ,
0.439924600000 ,
0.416183600000 ,
0.393882200000 ,
0.372945900000 ,
0.353300000000 ,
0.334857800000 ,
0.317552100000 ,
0.301337500000 ,
0.286168600000 ,
0.272000000000 ,
0.258817100000 ,
0.246483800000 ,
0.234771800000 ,
0.223453300000 ,
0.212300000000 ,
0.201169200000 ,
0.190119600000 ,
0.179225400000 ,
0.168560800000 ,
0.158200000000 ,
0.148138300000 ,
0.138375800000 ,
0.128994200000 ,
0.120075100000 ,
0.111700000000 ,
0.103904800000 ,
0.096667480000 ,
0.089982720000 ,
0.083845310000 ,
0.078249990000 ,
0.073208990000 ,
0.068678160000 ,
0.064567840000 ,
0.060788350000 ,
0.057250010000 ,
0.053904350000 ,
0.050746640000 ,
0.047752760000 ,
0.044898590000 ,
0.042160000000 ,
0.039507280000 ,
0.036935640000 ,
0.034458360000 ,
0.032088720000 ,
0.029840000000 ,
0.027711810000 ,
0.025694440000 ,
0.023787160000 ,
0.021989250000 ,
0.020300000000 ,
0.018718050000 ,
0.017240360000 ,
0.015863640000 ,
0.014584610000 ,
0.013400000000 ,
0.012307230000 ,
0.011301880000 ,
0.010377920000 ,
0.009529306000 ,
0.008749999000 ,
0.008035200000 ,
0.007381600000 ,
0.006785400000 ,
0.006242800000 ,
0.005749999000 ,
0.005303600000 ,
0.004899800000 ,
0.004534200000 ,
0.004202400000 ,
0.003900000000 ,
0.003623200000 ,
0.003370600000 ,
0.003141400000 ,
0.002934800000 ,
0.002749999000 ,
0.002585200000 ,
0.002438600000 ,
0.002309400000 ,
0.002196800000 ,
0.002100000000 ,
0.002017733000 ,
0.001948200000 ,
0.001889800000 ,
0.001840933000 ,
0.001800000000 ,
0.001766267000 ,
0.001737800000 ,
0.001711200000 ,
0.001683067000 ,
0.001650001000 ,
0.001610133000 ,
0.001564400000 ,
0.001513600000 ,
0.001458533000 ,
0.001400000000 ,
0.001336667000 ,
0.001270000000 ,
0.001205000000 ,
0.001146667000 ,
0.001100000000 ,
0.001068800000 ,
0.001049400000 ,
0.001035600000 ,
0.001021200000 ,
0.001000000000 ,
0.000968640000 ,
0.000929920000 ,
0.000886880000 ,
0.000842560000 ,
0.000800000000 ,
0.000760960000 ,
0.000723680000 ,
0.000685920000 ,
0.000645440000 ,
0.000600000000 ,
0.000547866700 ,
0.000491600000 ,
0.000435400000 ,
0.000383466700 ,
0.000340000000 ,
0.000307253300 ,
0.000283160000 ,
0.000265440000 ,
0.000251813300 ,
0.000240000000 ,
0.000229546700 ,
0.000220640000 ,
0.000211960000 ,
0.000202186700 ,
0.000190000000 ,
0.000174213300 ,
0.000155640000 ,
0.000135960000 ,
0.000116853300 ,
0.000100000000 ,
0.000086133330 ,
0.000074600000 ,
0.000065000000 ,
0.000056933330 ,
0.000049999990 ,
0.000044160000 ,
0.000039480000 ,
0.000035720000 ,
0.000032640000 ,
0.000030000000 ,
0.000027653330 ,
0.000025560000 ,
0.000023640000 ,
0.000021813330 ,
0.000020000000 ,
0.000018133330 ,
0.000016200000 ,
0.000014200000 ,
0.000012133330 ,
0.000010000000 ,
0.000007733333 ,
0.000005400000 ,
0.000003200000 ,
0.000001333333 ,
0.000000000000
        };

        private static readonly double[] cieVs = new double[]
        {
            5.890e-4 ,
            6.650e-4 ,
            7.520e-4 ,
            8.540e-4 ,
            9.720e-4 ,
            1.108e-3 ,
            1.268e-3 ,
            1.453e-3 ,
            1.668e-3 ,
            1.918e-3 ,
            2.209e-3 ,
            2.547e-3 ,
            2.939e-3 ,
            3.394e-3 ,
            3.921e-3 ,
            4.530e-3 ,
            5.240e-3 ,
            6.050e-3 ,
            6.980e-3 ,
            8.060e-3 ,
            9.290e-3 ,
            1.070e-2 ,
            1.231e-2 ,
            1.413e-2 ,
            1.619e-2 ,
            1.852e-2 ,
            2.113e-2 ,
            2.405e-2 ,
            2.730e-2 ,
            3.089e-2 ,
            3.484e-2 ,
            3.916e-2 ,
            4.390e-2 ,
            4.900e-2 ,
            5.450e-2 ,
            6.040e-2 ,
            6.680e-2 ,
            7.360e-2 ,
            8.080e-2 ,
            8.850e-2 ,
            9.660e-2 ,
            1.052e-1 ,
            1.141e-1 ,
            1.235e-1 ,
            1.334e-1 ,
            1.436e-1 ,
            1.541e-1 ,
            1.651e-1 ,
            1.764e-1 ,
            1.879e-1 ,
            1.998e-1 ,
            2.119e-1 ,
            2.243e-1 ,
            2.369e-1 ,
            2.496e-1 ,
            2.625e-1 ,
            2.755e-1 ,
            2.886e-1 ,
            3.017e-1 ,
            3.149e-1 ,
            3.281e-1 ,
            3.412e-1 ,
            3.543e-1 ,
            3.673e-1 ,
            3.803e-1 ,
            3.931e-1 ,
            4.060e-1 ,
            4.180e-1 ,
            4.310e-1 ,
            4.430e-1 ,
            4.550e-1 ,
            4.670e-1 ,
            4.790e-1 ,
            4.900e-1 ,
            5.020e-1 ,
            5.130e-1 ,
            5.240e-1 ,
            5.350e-1 ,
            5.460e-1 ,
            5.570e-1 ,
            5.670e-1 ,
            5.780e-1 ,
            5.880e-1 ,
            5.990e-1 ,
            6.100e-1 ,
            6.200e-1 ,
            6.310e-1 ,
            6.420e-1 ,
            6.530e-1 ,
            6.640e-1 ,
            6.760e-1 ,
            6.870e-1 ,
            6.990e-1 ,
            7.100e-1 ,
            7.220e-1 ,
            7.340e-1 ,
            7.450e-1 ,
            7.570e-1 ,
            7.690e-1 ,
            7.810e-1 ,
            7.930e-1 ,
            8.050e-1 ,
            8.170e-1 ,
            8.280e-1 ,
            8.400e-1 ,
            8.510e-1 ,
            8.620e-1 ,
            8.730e-1 ,
            8.840e-1 ,
            8.940e-1 ,
            9.040e-1 ,
            9.140e-1 ,
            9.230e-1 ,
            9.320e-1 ,
            9.410e-1 ,
            9.490e-1 ,
            9.570e-1 ,
            9.640e-1 ,
            9.700e-1 ,
            9.760e-1 ,
            9.820e-1 ,
            9.860e-1 ,
            9.900e-1 ,
            9.940e-1 ,
            9.970e-1 ,
            9.980e-1 ,
            1.000e+0 ,
            1.000e+0 ,
            1.000e+0 ,
            9.980e-1 ,
            9.970e-1 ,
            9.940e-1 ,
            9.900e-1 ,
            9.860e-1 ,
            9.810e-1 ,
            9.750e-1 ,
            9.680e-1 ,
            9.610e-1 ,
            9.530e-1 ,
            9.440e-1 ,
            9.350e-1 ,
            9.250e-1 ,
            9.150e-1 ,
            9.040e-1 ,
            8.920e-1 ,
            8.800e-1 ,
            8.670e-1 ,
            8.540e-1 ,
            8.400e-1 ,
            8.260e-1 ,
            8.110e-1 ,
            7.960e-1 ,
            7.810e-1 ,
            7.650e-1 ,
            7.490e-1 ,
            7.330e-1 ,
            7.170e-1 ,
            7.000e-1 ,
            6.830e-1 ,
            6.670e-1 ,
            6.500e-1 ,
            6.330e-1 ,
            6.160e-1 ,
            5.990e-1 ,
            5.810e-1 ,
            5.640e-1 ,
            5.480e-1 ,
            5.310e-1 ,
            5.140e-1 ,
            4.970e-1 ,
            4.810e-1 ,
            4.650e-1 ,
            4.480e-1 ,
            4.330e-1 ,
            4.170e-1 ,
            4.020e-1 ,
            3.864e-1 ,
            3.715e-1 ,
            3.569e-1 ,
            3.427e-1 ,
            3.288e-1 ,
            3.151e-1 ,
            3.018e-1 ,
            2.888e-1 ,
            2.762e-1 ,
            2.639e-1 ,
            2.519e-1 ,
            2.403e-1 ,
            2.291e-1 ,
            2.182e-1 ,
            2.076e-1 ,
            1.974e-1 ,
            1.876e-1 ,
            1.782e-1 ,
            1.690e-1 ,
            1.602e-1 ,
            1.517e-1 ,
            1.436e-1 ,
            1.358e-1 ,
            1.284e-1 ,
            1.212e-1 ,
            1.143e-1 ,
            1.078e-1 ,
            1.015e-1 ,
            9.560e-2 ,
            8.990e-2 ,
            8.450e-2 ,
            7.930e-2 ,
            7.450e-2 ,
            6.990e-2 ,
            6.550e-2 ,
            6.130e-2 ,
            5.740e-2 ,
            5.370e-2 ,
            5.020e-2 ,
            4.690e-2 ,
            4.380e-2 ,
            4.090e-2 ,
            3.816e-2 ,
            3.558e-2 ,
            3.315e-2 ,
            3.087e-2 ,
            2.874e-2 ,
            2.674e-2 ,
            2.487e-2 ,
            2.312e-2 ,
            2.147e-2 ,
            1.994e-2 ,
            1.851e-2 ,
            1.718e-2 ,
            1.593e-2 ,
            1.477e-2 ,
            1.369e-2 ,
            1.269e-2 ,
            1.175e-2 ,
            1.088e-2 ,
            1.007e-2 ,
            9.320e-3 ,
            8.620e-3 ,
            7.970e-3 ,
            7.370e-3 ,
            6.820e-3 ,
            6.300e-3 ,
            5.820e-3 ,
            5.380e-3 ,
            4.970e-3 ,
            4.590e-3 ,
            4.240e-3 ,
            3.913e-3 ,
            3.613e-3 ,
            3.335e-3 ,
            3.079e-3 ,
            2.842e-3 ,
            2.623e-3 ,
            2.421e-3 ,
            2.235e-3 ,
            2.062e-3 ,
            1.903e-3 ,
            1.757e-3 ,
            1.621e-3 ,
            1.497e-3 ,
            1.382e-3 ,
            1.276e-3 ,
            1.178e-3 ,
            1.088e-3 ,
            1.005e-3 ,
            9.280e-4 ,
            8.570e-4 ,
            7.920e-4 ,
            7.320e-4 ,
            6.770e-4 ,
            6.260e-4 ,
            5.790e-4 ,
            5.360e-4 ,
            4.960e-4 ,
            4.590e-4 ,
            4.250e-4 ,
            3.935e-4 ,
            3.645e-4 ,
            3.377e-4 ,
            3.129e-4 ,
            2.901e-4 ,
            2.689e-4 ,
            2.493e-4 ,
            2.313e-4 ,
            2.146e-4 ,
            1.991e-4 ,
            1.848e-4 ,
            1.716e-4 ,
            1.593e-4 ,
            1.480e-4 ,
            1.375e-4 ,
            1.277e-4 ,
            1.187e-4 ,
            1.104e-4 ,
            1.026e-4 ,
            9.540e-5 ,
            8.880e-5 ,
            8.260e-5 ,
            7.690e-5 ,
            7.150e-5 ,
            6.660e-5 ,
            6.200e-5 ,
            5.780e-5 ,
            5.380e-5 ,
            5.010e-5 ,
            4.670e-5 ,
            4.360e-5 ,
            4.060e-5 ,
            3.789e-5 ,
            3.533e-5 ,
            3.295e-5 ,
            3.075e-5 ,
            2.870e-5 ,
            2.679e-5 ,
            2.501e-5 ,
            2.336e-5 ,
            2.182e-5 ,
            2.038e-5 ,
            1.905e-5 ,
            1.780e-5 ,
            1.664e-5 ,
            1.556e-5 ,
            1.454e-5 ,
            1.360e-5 ,
            1.273e-5 ,
            1.191e-5 ,
            1.114e-5 ,
            1.043e-5 ,
            9.760e-6 ,
            9.140e-6 ,
            8.560e-6 ,
            8.020e-6 ,
            7.510e-6 ,
            7.040e-6 ,
            6.600e-6 ,
            6.180e-6 ,
            5.800e-6 ,
            5.440e-6 ,
            5.100e-6 ,
            4.780e-6 ,
            4.490e-6 ,
            4.210e-6 ,
            3.951e-6 ,
            3.709e-6 ,
            3.482e-6 ,
            3.270e-6 ,
            3.070e-6 ,
            2.884e-6 ,
            2.710e-6 ,
            2.546e-6 ,
            2.393e-6 ,
            2.250e-6 ,
            2.115e-6 ,
            1.989e-6 ,
            1.870e-6 ,
            1.759e-6 ,
            1.655e-6 ,
            1.557e-6 ,
            1.466e-6 ,
            1.379e-6 ,
            1.299e-6 ,
            1.223e-6 ,
            1.151e-6 ,
            1.084e-6 ,
            1.022e-6 ,
            9.620e-7 ,
            9.070e-7 ,
            8.550e-7 ,
            8.060e-7 ,
            7.600e-7 ,
            7.160e-7 ,
            6.750e-7 ,
            6.370e-7 ,
            6.010e-7 ,
            5.670e-7 ,
            5.350e-7 ,
            5.050e-7 ,
            4.770e-7 ,
            4.500e-7 ,
            4.250e-7 ,
            4.010e-7 ,
            3.790e-7 ,
            3.580e-7 ,
            3.382e-7 ,
            3.196e-7 ,
            3.021e-7 ,
            2.855e-7 ,
            2.699e-7 ,
            2.552e-7 ,
            2.413e-7 ,
            2.282e-7 ,
            2.159e-7 ,
            2.042e-7 ,
            1.932e-7 ,
            1.829e-7 ,
            1.731e-7 ,
            1.638e-7 ,
            1.551e-7 ,
            1.468e-7 ,
            1.390e-7
        };

        private static readonly double[] cieD65 = new double[]
        {
            0.0341,
0.36014,
0.68618,
1.01222,
1.33826,
1.6643,
1.99034,
2.31638,
2.64242,
2.96846,
3.2945,
4.98865,
6.6828,
8.37695,
10.0711,
11.7652,
13.4594,
15.1535,
16.8477,
18.5418,
20.236,
21.9177,
23.5995,
25.2812,
26.963,
28.6447,
30.3265,
32.0082,
33.69,
35.3717,
37.0535,
37.343,
37.6326,
37.9221,
38.2116,
38.5011,
38.7907,
39.0802,
39.3697,
39.6593,
39.9488,
40.4451,
40.9414,
41.4377,
41.934,
42.4302,
42.9265,
43.4228,
43.9191,
44.4154,
44.9117,
45.0844,
45.257,
45.4297,
45.6023,
45.775,
45.9477,
46.1203,
46.293,
46.4656,
46.6383,
47.1834,
47.7285,
48.2735,
48.8186,
49.3637,
49.9088,
50.4539,
50.9989,
51.544,
52.0891,
51.8777,
51.6664,
51.455,
51.2437,
51.0323,
50.8209,
50.6096,
50.3982,
50.1869,
49.9755,
50.4428,
50.91,
51.3773,
51.8446,
52.3118,
52.7791,
53.2464,
53.7137,
54.1809,
54.6482,
57.4589,
60.2695,
63.0802,
65.8909,
68.7015,
71.5122,
74.3229,
77.1336,
79.9442,
82.7549,
83.628,
84.5011,
85.3742,
86.2473,
87.1204,
87.9936,
88.8667,
89.7398,
90.6129,
91.486,
91.6806,
91.8752,
92.0697,
92.2643,
92.4589,
92.6535,
92.8481,
93.0426,
93.2372,
93.4318,
92.7568,
92.0819,
91.4069,
90.732,
90.057,
89.3821,
88.7071,
88.0322,
87.3572,
86.6823,
88.5006,
90.3188,
92.1371,
93.9554,
95.7736,
97.5919,
99.4102,
101.228,
103.047,
104.865,
106.079,
107.294,
108.508,
109.722,
110.936,
112.151,
113.365,
114.579,
115.794,
117.008,
117.088,
117.169,
117.249,
117.33,
117.41,
117.49,
117.571,
117.651,
117.732,
117.812,
117.517,
117.222,
116.927,
116.632,
116.336,
116.041,
115.746,
115.451,
115.156,
114.861,
114.967,
115.073,
115.18,
115.286,
115.392,
115.498,
115.604,
115.711,
115.817,
115.923,
115.212,
114.501,
113.789,
113.078,
112.367,
111.656,
110.945,
110.233,
109.522,
108.811,
108.865,
108.92,
108.974,
109.028,
109.082,
109.137,
109.191,
109.245,
109.3,
109.354,
109.199,
109.044,
108.888,
108.733,
108.578,
108.423,
108.268,
108.112,
107.957,
107.802,
107.501,
107.2,
106.898,
106.597,
106.296,
105.995,
105.694,
105.392,
105.091,
104.79,
105.08,
105.37,
105.66,
105.95,
106.239,
106.529,
106.819,
107.109,
107.399,
107.689,
107.361,
107.032,
106.704,
106.375,
106.047,
105.719,
105.39,
105.062,
104.733,
104.405,
104.369,
104.333,
104.297,
104.261,
104.225,
104.19,
104.154,
104.118,
104.082,
104.046,
103.641,
103.237,
102.832,
102.428,
102.023,
101.618,
101.214,
100.809,
100.405,
100,
99.6334,
99.2668,
98.9003,
98.5337,
98.1671,
97.8005,
97.4339,
97.0674,
96.7008,
96.3342,
96.2796,
96.225,
96.1703,
96.1157,
96.0611,
96.0065,
95.9519,
95.8972,
95.8426,
95.788,
95.0778,
94.3675,
93.6573,
92.947,
92.2368,
91.5266,
90.8163,
90.1061,
89.3958,
88.6856,
88.8177,
88.9497,
89.0818,
89.2138,
89.3459,
89.478,
89.61,
89.7421,
89.8741,
90.0062,
89.9655,
89.9248,
89.8841,
89.8434,
89.8026,
89.7619,
89.7212,
89.6805,
89.6398,
89.5991,
89.4091,
89.219,
89.029,
88.8389,
88.6489,
88.4589,
88.2688,
88.0788,
87.8887,
87.6987,
87.2577,
86.8167,
86.3757,
85.9347,
85.4936,
85.0526,
84.6116,
84.1706,
83.7296,
83.2886,
83.3297,
83.3707,
83.4118,
83.4528,
83.4939,
83.535,
83.576,
83.6171,
83.6581,
83.6992,
83.332,
82.9647,
82.5975,
82.2302,
81.863,
81.4958,
81.1285,
80.7613,
80.394,
80.0268,
80.0456,
80.0644,
80.0831,
80.1019,
80.1207,
80.1395,
80.1583,
80.177,
80.1958,
80.2146,
80.4209,
80.6272,
80.8336,
81.0399,
81.2462,
81.4525,
81.6588,
81.8652,
82.0715,
82.2778,
81.8784,
81.4791,
81.0797,
80.6804,
80.281,
79.8816,
79.4823,
79.0829,
78.6836,
78.2842,
77.4279,
76.5716,
75.7153,
74.859,
74.0027,
73.1465,
72.2902,
71.4339,
70.5776,
69.7213,
69.9101,
70.0989,
70.2876,
70.4764,
70.6652,
70.854,
71.0428,
71.2315,
71.4203,
71.6091,
71.8831,
72.1571,
72.4311,
72.7051,
72.979,
73.253,
73.527,
73.801,
74.075,
74.349,
73.0745,
71.8,
70.5255,
69.251,
67.9765,
66.702,
65.4275,
64.153,
62.8785,
61.604,
62.4322,
63.2603,
64.0885,
64.9166,
65.7448,
66.573,
67.4011,
68.2293,
69.0574,
69.8856,
70.4057,
70.9259,
71.446,
71.9662,
72.4863,
73.0064,
73.5266,
74.0467,
74.5669,
75.087,
73.9376,
72.7881,
71.6387,
70.4893,
69.3398,
68.1904,
67.041,
65.8916,
64.7421,
63.5927,
61.8752,
60.1578,
58.4403,
56.7229,
55.0054,
53.288,
51.5705,
49.8531,
48.1356,
46.4182,
48.4569,
50.4956,
52.5344,
54.5731,
56.6118,
58.6505,
60.6892,
62.728,
64.7667,
66.8054,
66.4631,
66.1209,
65.7786,
65.4364,
65.0941,
64.7518,
64.4096,
64.0673,
63.7251,
63.3828,
63.4749,
63.567,
63.6592,
63.7513,
63.8434,
63.9355,
64.0276,
64.1198,
64.2119,
64.304,
63.8188,
63.3336,
62.8484,
62.3632,
61.8779,
61.3927,
60.9075,
60.4223,
59.9371,
59.4519,
58.7026,
57.9533,
57.204,
56.4547,
55.7054,
54.9562,
54.2069,
53.4576,
52.7083,
51.959,
52.5072,
53.0553,
53.6035,
54.1516,
54.6998,
55.248,
55.7961,
56.3443,
56.8924,
57.4406,
57.7278,
58.015,
58.3022,
58.5894,
58.8765,
59.1637,
59.4509,
59.7381,
60.0253,
60.3125
        };

        private static readonly double[] cieD50 = new double[]
            {
                0.01922 ,
0.222348 ,
0.425476 ,
0.628604 ,
0.831732 ,
1.03486 ,
1.23799 ,
1.44112 ,
1.64424 ,
1.84737 ,
2.0505 ,
2.62329 ,
3.19608 ,
3.76887 ,
4.34166 ,
4.91445 ,
5.48724 ,
6.06003 ,
6.63282 ,
7.20561 ,
7.7784 ,
8.47531 ,
9.17222 ,
9.86913 ,
10.566 ,
11.263 ,
11.9599 ,
12.6568 ,
13.3537 ,
14.0506 ,
14.7475 ,
15.0676 ,
15.3876 ,
15.7076 ,
16.0277 ,
16.3478 ,
16.6678 ,
16.9878 ,
17.3079 ,
17.628 ,
17.948 ,
18.2542 ,
18.5603 ,
18.8665 ,
19.1727 ,
19.4788 ,
19.785 ,
20.0912 ,
20.3974 ,
20.7035 ,
21.0097 ,
21.3029 ,
21.5961 ,
21.8894 ,
22.1826 ,
22.4758 ,
22.769 ,
23.0622 ,
23.3555 ,
23.6487 ,
23.9419 ,
24.2438 ,
24.5457 ,
24.8475 ,
25.1494 ,
25.4513 ,
25.7532 ,
26.0551 ,
26.3569 ,
26.6588 ,
26.9607 ,
26.7134 ,
26.4661 ,
26.2187 ,
25.9714 ,
25.7241 ,
25.4768 ,
25.2295 ,
24.9821 ,
24.7348 ,
24.4875 ,
25.0258 ,
25.5641 ,
26.1024 ,
26.6407 ,
27.179 ,
27.7174 ,
28.2557 ,
28.794 ,
29.3323 ,
29.8706 ,
31.8144 ,
33.7581 ,
35.7018 ,
37.6456 ,
39.5894 ,
41.5331 ,
43.4768 ,
45.4206 ,
47.3644 ,
49.3081 ,
50.0286 ,
50.749 ,
51.4695 ,
52.19 ,
52.9104 ,
53.6309 ,
54.3514 ,
55.0719 ,
55.7923 ,
56.5128 ,
56.8649 ,
57.217 ,
57.5691 ,
57.9212 ,
58.2733 ,
58.6254 ,
58.9775 ,
59.3296 ,
59.6817 ,
60.0338 ,
59.8122 ,
59.5905 ,
59.3689 ,
59.1473 ,
58.9256 ,
58.704 ,
58.4824 ,
58.2608 ,
58.0391 ,
57.8175 ,
59.5182 ,
61.219 ,
62.9197 ,
64.6205 ,
66.3212 ,
68.0219 ,
69.7227 ,
71.4234 ,
73.1242 ,
74.8249 ,
76.0671 ,
77.3094 ,
78.5516 ,
79.7938 ,
81.036 ,
82.2783 ,
83.5205 ,
84.7627 ,
86.005 ,
87.2472 ,
87.5837 ,
87.9202 ,
88.2567 ,
88.5932 ,
88.9297 ,
89.2662 ,
89.6027 ,
89.9392 ,
90.2757 ,
90.6122 ,
90.6878 ,
90.7634 ,
90.839 ,
90.9146 ,
90.9902 ,
91.0657 ,
91.1413 ,
91.2169 ,
91.2925 ,
91.3681 ,
91.7421 ,
92.1162 ,
92.4902 ,
92.8643 ,
93.2383 ,
93.6123 ,
93.9864 ,
94.3604 ,
94.7345 ,
95.1085 ,
94.7939 ,
94.4793 ,
94.1648 ,
93.8502 ,
93.5356 ,
93.221 ,
92.9064 ,
92.5919 ,
92.2773 ,
91.9627 ,
92.3388 ,
92.7149 ,
93.091 ,
93.4671 ,
93.8432 ,
94.2193 ,
94.5954 ,
94.9715 ,
95.3476 ,
95.7237 ,
95.8127 ,
95.9016 ,
95.9906 ,
96.0795 ,
96.1685 ,
96.2575 ,
96.3464 ,
96.4354 ,
96.5243 ,
96.6133 ,
96.6649 ,
96.7164 ,
96.768 ,
96.8196 ,
96.8712 ,
96.9227 ,
96.9743 ,
97.0259 ,
97.0774 ,
97.129 ,
97.626 ,
98.123 ,
98.62 ,
99.117 ,
99.614 ,
100.111 ,
100.608 ,
101.105 ,
101.602 ,
102.099 ,
101.965 ,
101.83 ,
101.696 ,
101.561 ,
101.427 ,
101.292 ,
101.158 ,
101.024 ,
100.889 ,
100.755 ,
100.911 ,
101.067 ,
101.223 ,
101.38 ,
101.536 ,
101.692 ,
101.848 ,
102.005 ,
102.161 ,
102.317 ,
102.085 ,
101.854 ,
101.622 ,
101.39 ,
101.158 ,
100.927 ,
100.695 ,
100.463 ,
100.232 ,
100 ,
99.7735 ,
99.547 ,
99.3205 ,
99.094 ,
98.8675 ,
98.641 ,
98.4145 ,
98.188 ,
97.9615 ,
97.735 ,
97.8533 ,
97.9716 ,
98.0899 ,
98.2082 ,
98.3265 ,
98.4448 ,
98.5631 ,
98.6814 ,
98.7997 ,
98.918 ,
98.3761 ,
97.8342 ,
97.2922 ,
96.7503 ,
96.2084 ,
95.6665 ,
95.1246 ,
94.5826 ,
94.0407 ,
93.4988 ,
93.9177 ,
94.3366 ,
94.7555 ,
95.1744 ,
95.5933 ,
96.0122 ,
96.4311 ,
96.85 ,
97.2689 ,
97.6878 ,
97.8459 ,
98.0041 ,
98.1622 ,
98.3203 ,
98.4784 ,
98.6366 ,
98.7947 ,
98.9528 ,
99.111 ,
99.2691 ,
99.2463 ,
99.2236 ,
99.2008 ,
99.1781 ,
99.1553 ,
99.1325 ,
99.1098 ,
99.087 ,
99.0643 ,
99.0415 ,
98.7095 ,
98.3776 ,
98.0456 ,
97.7136 ,
97.3816 ,
97.0497 ,
96.7177 ,
96.3857 ,
96.0538 ,
95.7218 ,
96.0353 ,
96.3489 ,
96.6624 ,
96.976 ,
97.2895 ,
97.603 ,
97.9166 ,
98.2301 ,
98.5437 ,
98.8572 ,
98.5382 ,
98.2192 ,
97.9002 ,
97.5812 ,
97.2622 ,
96.9432 ,
96.6242 ,
96.3052 ,
95.9862 ,
95.6672 ,
95.9195 ,
96.1717 ,
96.424 ,
96.6762 ,
96.9285 ,
97.1808 ,
97.433 ,
97.6853 ,
97.9375 ,
98.1898 ,
98.6712 ,
99.1525 ,
99.6339 ,
100.115 ,
100.597 ,
101.078 ,
101.559 ,
102.041 ,
102.522 ,
103.003 ,
102.616 ,
102.229 ,
101.842 ,
101.455 ,
101.068 ,
100.681 ,
100.294 ,
99.9071 ,
99.52 ,
99.133 ,
97.9578 ,
96.7826 ,
95.6074 ,
94.4322 ,
93.257 ,
92.0817 ,
90.9065 ,
89.7313 ,
88.5561 ,
87.3809 ,
87.8032 ,
88.2254 ,
88.6477 ,
89.0699 ,
89.4922 ,
89.9145 ,
90.3367 ,
90.759 ,
91.1812 ,
91.6035 ,
91.732 ,
91.8605 ,
91.989 ,
92.1175 ,
92.246 ,
92.3746 ,
92.5031 ,
92.6316 ,
92.7601 ,
92.8886 ,
91.2852 ,
89.6818 ,
88.0783 ,
86.4749 ,
84.8715 ,
83.2681 ,
81.6647 ,
80.0612 ,
78.4578 ,
76.8544 ,
77.8201 ,
78.7858 ,
79.7514 ,
80.7171 ,
81.6828 ,
82.6485 ,
83.6142 ,
84.5798 ,
85.5455 ,
86.5112 ,
87.1181 ,
87.7249 ,
88.3318 ,
88.9386 ,
89.5455 ,
90.1524 ,
90.7592 ,
91.3661 ,
91.9729 ,
92.5798 ,
91.1448 ,
89.7098 ,
88.2748 ,
86.8398 ,
85.4048 ,
83.9699 ,
82.5349 ,
81.0999 ,
79.6649 ,
78.2299 ,
76.1761 ,
74.1223 ,
72.0685 ,
70.0147 ,
67.9608 ,
65.907 ,
63.8532 ,
61.7994 ,
59.7456 ,
57.6918 ,
60.2149 ,
62.738 ,
65.2612 ,
67.7843 ,
70.3074 ,
72.8305 ,
75.3536 ,
77.8768 ,
80.3999 ,
82.923 ,
82.4581 ,
81.9932 ,
81.5283 ,
81.0634 ,
80.5985 ,
80.1336 ,
79.6687 ,
79.2038 ,
78.7389 ,
78.274 ,
78.402 ,
78.5301 ,
78.6581 ,
78.7862 ,
78.9142 ,
79.0422 ,
79.1703 ,
79.2983 ,
79.4264 ,
79.5544 ,
78.9391 ,
78.3238 ,
77.7085 ,
77.0932 ,
76.478 ,
75.8627 ,
75.2474 ,
74.6321 ,
74.0168 ,
73.4015 ,
72.4534 ,
71.5052 ,
70.5571 ,
69.609 ,
68.6608 ,
67.7127 ,
66.7646 ,
65.8165 ,
64.8683 ,
63.9202 ,
64.6059 ,
65.2916 ,
65.9772 ,
66.6629 ,
67.3486 ,
68.0343 ,
68.72 ,
69.4056 ,
70.0913 ,
70.777 ,
71.1435 ,
71.5099 ,
71.8764 ,
72.2429 ,
72.6094 ,
72.9758 ,
73.3423 ,
73.7088 ,
74.0752 ,
74.4417
            };

        private static double ConvertArrayToFunction(int lambda, double[] array, int offset)
        {
            int index = lambda - offset;
            if (index < 0)
                return 0.0;
            if (index >= array.Length)
                return 0.0;
            return array[index];
        }
        #endregion

        #region Methods for validation
        private static decimal SumAllValuesOfArray(double[] tabularData)
        {
            decimal sum = 0.0m;
            foreach (var value in tabularData)
                sum += (decimal)value;
            return sum;
        }

        public static void ValidateDataTables()
        {
            double[][] tables = new double[][] { cieX2, cieV, cieZ2, cieVs, cieD65, cieD50 };
            string[] tableNames = new string[] { "cieX2", "cieV", "cieZ2", "cieVs", "cieD65", "cieD50" }; // can get out of sync!
            Console.WriteLine("===================================================");
            Console.WriteLine("Validation of numerical tables");
            for (int i = 0; i < tables.Length; i++)
            {
                Console.WriteLine($"   table #{i,2} : {tableNames[i],7} : {SumAllValuesOfArray(tables[i]):F14}");
            }
            Console.WriteLine("===================================================");
        }
        #endregion
    }
}
